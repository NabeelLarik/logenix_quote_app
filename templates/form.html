<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Logenix Quote Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background: #f5f6fa; }
        .form-card { max-width: 1100px; margin: auto; border-radius: 12px; }
        .card { border: none; border-radius: 12px; }
        .form-label { font-weight: 600; }

        .rate-card {
            border-radius: 12px;
            border: 1px solid #dee2e6;
            background: #ffffff;
        }
        .rate-card.best {
            border: 2px solid #198754;
            box-shadow: 0 0 0 0.15rem rgba(25, 135, 84, .15);
        }

        .route-card {
            border-radius: 12px;
            border: 1px solid #dee2e6;
            background: #ffffff;
        }
        .route-card.best {
            border: 2px solid #0d6efd;
            box-shadow: 0 0 0 0.15rem rgba(13, 110, 253, .15);
        }

        .rate-header, .route-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
            color: #0d6efd;
        }

        .badge-best {
            background: #198754;
            color: white;
            font-weight: 700;
            border-radius: 999px;
            padding: 6px 10px;
            font-size: 12px;
        }

        .badge-best-route {
            background: #0d6efd;
            color: white;
            font-weight: 700;
            border-radius: 999px;
            padding: 6px 10px;
            font-size: 12px;
        }

        .badge-valid {
            background: #d1e7dd;
            color: #0f5132;
            font-weight: 700;
            border-radius: 999px;
            padding: 6px 10px;
            font-size: 12px;
        }

        .badge-expired {
            background: #f8d7da;
            color: #842029;
            font-weight: 700;
            border-radius: 999px;
            padding: 6px 10px;
            font-size: 12px;
        }

        .badge-unknown {
            background: #e2e3e5;
            color: #41464b;
            font-weight: 700;
            border-radius: 999px;
            padding: 6px 10px;
            font-size: 12px;
        }

        .kv {
            margin-top: 12px;
            font-size: 14px;
            font-weight: 400;
        }
        .kv .rowline {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            padding: 6px 0;
            border-bottom: 1px dashed #e9ecef;
        }
        .kv .key { font-weight: 600; color: #212529; flex: 1; }
        .kv .val { font-weight: 400; color: #212529; flex: 1; text-align: right; word-break: break-word; }

        .na { color: #dc3545; font-weight: 700; }

        /* GRAND TOTAL: BIG + BLUE */
        .gt-row {
            margin-top: 12px;
            padding: 14px 12px !important;
            border-radius: 12px;
            border: 2px solid #0d6efd;
            background: #e7f1ff;
        }
        .gt-row .key {
            color: #0d6efd !important;
            font-weight: 900 !important;
            font-size: 18px !important;
        }
        .gt-row .val {
            color: #0d6efd !important;
            font-weight: 900 !important;
            font-size: 22px !important;
        }

        .shipment-box {
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 12px 14px;
            background: #ffffff;
        }
        .shipment-title {
            font-weight: 700;
            margin-bottom: 8px;
        }

        .helper-note {
            font-size: 12px;
            color: #6c757d;
            margin-top: 6px;
        }

        .calc-line {
            margin-top: 6px;
            font-size: 13px;
        }
        .calc-line strong { font-weight: 700; }

        /* Reloading UI box */
        .reload-box {
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 12px 14px;
            background: #ffffff;
        }
        .reload-title { font-weight: 700; margin-bottom: 8px; }
        .reload-places { margin-top: 10px; }
    </style>
</head>

<body class="p-4">
<div class="container">
    <div class="card shadow p-4 form-card">

        <h3 class="mb-3 fw-bold text-primary">Logenix — Quote Input</h3>

        <form method="post" action="/submit" autocomplete="off" id="quoteForm">

            <datalist id="locations">
                {% for c in countries %}
                <option value="{{ c }}">
                {% endfor %}
            </datalist>

            <datalist id="container_types">
                {% for ct in container_types %}
                <option value="{{ ct }}">
                {% endfor %}
            </datalist>

            <datalist id="container_sizes">
                {% for cs in container_sizes %}
                <option value="{{ cs }}">
                {% endfor %}
            </datalist>

            <datalist id="commodities">
                {% for m in commodities %}
                <option value="{{ m }}">
                {% endfor %}
            </datalist>

            <datalist id="salespersons">
                {% for s in salespersons %}
                <option value="{{ s }}">
                {% endfor %}
            </datalist>

            <datalist id="cargo_types">
                {% for ct in cargo_types %}
                <option value="{{ ct }}">
                {% endfor %}
            </datalist>

            <datalist id="packaging_types">
                {% for p in packaging_types %}
                <option value="{{ p }}">
                {% endfor %}
            </datalist>

            <datalist id="insurance_rates">
                <option value="1%">
                <option value="1.5%">
                <option value="2%">
                <option value="2.5%">
                <option value="3%">
                <option value="3.5%">
                <option value="4%">
                <option value="none">
            </datalist>

            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Company Name / Your Name</label>
                    <input name="company_name" required class="form-control">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Salesperson Name</label>
                    <input name="salesperson_name" class="form-control" list="salespersons" required
                           placeholder="Select or type salesperson name">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Shipping From (Origin / POL)</label>
                    <input name="shipping_from" class="form-control" list="locations" required
                           placeholder="Start typing a location...">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Destination (POD)</label>
                    <input name="destination" class="form-control" list="locations" required
                           placeholder="Start typing a location...">
                </div>

                <!-- Transit borders -->
                <div class="col-md-6">
                    <label class="form-label">Transit Country Border 1</label>
                    <input name="transit_border_1" class="form-control" required
                           placeholder="Type border name (required)">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Transit Country Border 2</label>
                    <input name="transit_border_2" class="form-control" required
                           placeholder="Type border name (required)">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Transit Country Border 3 (Optional)</label>
                    <input name="transit_border_3" class="form-control"
                           placeholder="Type border name (optional)">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Transit Country Border 4 (Optional)</label>
                    <input name="transit_border_4" class="form-control"
                           placeholder="Type border name (optional)">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Cargo Type</label>
                    <input name="cargo_type" class="form-control" list="cargo_types" required
                           placeholder="Select or type cargo type">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Packaging Type</label>
                    <input name="packaging_type" class="form-control" list="packaging_types" required
                           placeholder="Select or type packaging type">
                </div>

                <!-- Free days return container -->
                <div class="col-md-6">
                    <label class="form-label">Free Days to Return Container</label>
                    <input name="free_days_return" type="number" step="1" min="0" required class="form-control"
                           placeholder="Enter free days (integer)">
                </div>

                <!-- ✅ NEW: Lifting/Labor required -->
                <div class="col-md-6">
                    <div class="shipment-box">
                        <div class="shipment-title">Lifting / Labor required?</div>

                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="lifting_labor_required" id="lift_yes" value="Yes" required>
                            <label class="form-check-label" for="lift_yes">Yes</label>
                        </div>

                        <div class="form-check mt-1">
                            <input class="form-check-input" type="radio" name="lifting_labor_required" id="lift_no" value="No" required>
                            <label class="form-check-label" for="lift_no">No</label>
                        </div>
                    </div>
                </div>

                <!-- Reloading Required block -->
                <div class="col-md-12">
                    <div class="reload-box">
                        <div class="reload-title">Reloading Required?</div>

                        <div class="row g-2">
                            <div class="col-md-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="reloading_required" id="reload_yes" value="Yes" required>
                                    <label class="form-check-label" for="reload_yes">Yes</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="reloading_required" id="reload_no" value="No" required>
                                    <label class="form-check-label" for="reload_no">No</label>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">How many reloadings are required? (1–5)</label>
                                <input name="reloading_count" id="reloading_count" type="number" step="1" min="1" max="5"
                                       class="form-control" placeholder="Enter integer 1 to 5" disabled>
                                <div id="reloading_help" class="helper-note">
                                    Select "Yes" to unlock reloading details.
                                </div>
                            </div>
                        </div>

                        <div class="reload-places" id="reloading_places_wrap" style="display:none;">
                            <div class="row g-3" id="reloading_places_container">
                                <!-- dynamic inputs inserted here -->
                            </div>
                        </div>

                    </div>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Commodity</label>
                    <input name="commodity" class="form-control" list="commodities" required
                           placeholder="Select or type commodity">
                </div>

                <!-- Cargo Value -->
                <div class="col-md-6">
                    <label class="form-label">Cargo Value (Cost of Cargo)</label>
                    <input name="cargo_value" id="cargo_value" type="number" step="0.01" min="0"
                           class="form-control" placeholder="Enter cargo value (e.g., 1000)">
                </div>

                <!-- Insurance Required -->
                <div class="col-md-6">
                    <label class="form-label">Insurance Required?</label>
                    <input name="insurance_rate" id="insurance_rate" class="form-control" list="insurance_rates"
                           placeholder="Select or type % (e.g., 2.5%)" disabled>
                    <div id="insurance_help" class="helper-note">
                        If you want insurance then please give the cargo value first.
                    </div>
                    <div id="insurance_calc" class="calc-line"></div>
                </div>

                <!-- Weight -->
                <div class="col-md-3">
                    <label class="form-label">Weight (tons)</label>
                    <select name="weight_choice" id="weight_choice" required class="form-select">
                        <option value="" selected disabled>Select weight range</option>
                        <option value="5-10 tons">5-10 tons</option>
                        <option value="10-15 tons">10-15 tons</option>
                        <option value="15-20 tons">15-20 tons</option>
                        <option value="20-25 tons">20-25 tons</option>
                        <option value="25-30 tons">25-30 tons</option>
                        <option value="Other">Other</option>
                    </select>
                    <input type="number" step="0.01" min="0" name="weight_other" id="weight_other"
                           class="form-control mt-2" placeholder="Type weight in tons"
                           style="display:none;">
                </div>

                <!-- Type of Container -->
                <div class="col-md-3">
                    <label class="form-label">Type of Container</label>
                    <input name="container_type" list="container_types" required class="form-control"
                           placeholder="Select or type">
                </div>

                <!-- Container Size -->
                <div class="col-md-6">
                    <label class="form-label">Container Size</label>
                    <input name="container_size" list="container_sizes" required class="form-control"
                           placeholder="Select or type container size">
                </div>

                <!-- Number of containers required -->
                <div class="col-md-6">
                    <label class="form-label">Number of Containers Required</label>
                    <input name="num_containers" type="number" step="1" min="1" required class="form-control"
                           placeholder="Enter whole number (e.g., 1, 2, 3)">
                </div>

                <!-- Shipment Type -->
                <div class="col-md-6">
                    <div class="shipment-box">
                        <div class="shipment-title">Shipment Type</div>

                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="shipment_type" id="ship_commercial" value="Commercial" required>
                            <label class="form-check-label" for="ship_commercial">Commercial</label>
                        </div>

                        <div class="form-check mt-1">
                            <input class="form-check-input" type="radio" name="shipment_type" id="ship_noncommercial" value="Non-Commercial" required>
                            <label class="form-check-label" for="ship_noncommercial">Non-Commercial</label>
                        </div>
                    </div>
                </div>

                <!-- SOC / COC -->
                <div class="col-md-6">
                    <div class="shipment-box">
                        <div class="shipment-title">Container Ownership</div>

                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="container_ownership" id="own_soc" value="SOC" required>
                            <label class="form-check-label" for="own_soc">SOC</label>
                        </div>

                        <div class="form-check mt-1">
                            <input class="form-check-input" type="radio" name="container_ownership" id="own_coc" value="COC" required>
                            <label class="form-check-label" for="own_coc">COC</label>
                        </div>
                    </div>
                </div>

                <!-- Incoterm -->
                <div class="col-md-12">
                    <div class="shipment-box">
                        <div class="shipment-title">Incoterm</div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="incoterm" id="inc_exw" value="EXW – Ex Works" required>
                                    <label class="form-check-label" for="inc_exw">EXW – Ex Works</label>
                                </div>
                                <div class="form-check mt-1">
                                    <input class="form-check-input" type="radio" name="incoterm" id="inc_fca" value="FCA – Free Carrier" required>
                                    <label class="form-check-label" for="inc_fca">FCA – Free Carrier</label>
                                </div>
                                <div class="form-check mt-1">
                                    <input class="form-check-input" type="radio" name="incoterm" id="inc_cpt" value="CPT – Carriage Paid To" required>
                                    <label class="form-check-label" for="inc_cpt">CPT – Carriage Paid To</label>
                                </div>
                                <div class="form-check mt-1">
                                    <input class="form-check-input" type="radio" name="incoterm" id="inc_cip" value="CIP – Carriage and Insurance Paid To" required>
                                    <label class="form-check-label" for="inc_cip">CIP – Carriage and Insurance Paid To</label>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="incoterm" id="inc_dap" value="DAP – Delivered at Place" required>
                                    <label class="form-check-label" for="inc_dap">DAP – Delivered at Place</label>
                                </div>
                                <div class="form-check mt-1">
                                    <input class="form-check-input" type="radio" name="incoterm" id="inc_dpu" value="DPU – Delivered at Place Unloaded" required>
                                    <label class="form-check-label" for="inc_dpu">DPU – Delivered at Place Unloaded</label>
                                </div>
                                <div class="form-check mt-1">
                                    <input class="form-check-input" type="radio" name="incoterm" id="inc_ddp" value="DDP – Delivered Duty Paid" required>
                                    <label class="form-check-label" for="inc_ddp">DDP – Delivered Duty Paid</label>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="incoterm" id="inc_fas" value="FAS – Free Alongside Ship" required>
                                    <label class="form-check-label" for="inc_fas">FAS – Free Alongside Ship</label>
                                </div>
                                <div class="form-check mt-1">
                                    <input class="form-check-input" type="radio" name="incoterm" id="inc_fob" value="FOB – Free on Board" required>
                                    <label class="form-check-label" for="inc_fob">FOB – Free on Board</label>
                                </div>
                                <div class="form-check mt-1">
                                    <input class="form-check-input" type="radio" name="incoterm" id="inc_cfr" value="CFR – Cost and Freight" required>
                                    <label class="form-check-label" for="inc_cfr">CFR – Cost and Freight</label>
                                </div>
                                <div class="form-check mt-1">
                                    <input class="form-check-input" type="radio" name="incoterm" id="inc_cif" value="CIF – Cost, Insurance and Freight" required>
                                    <label class="form-check-label" for="inc_cif">CIF – Cost, Insurance and Freight</label>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="text-end mt-4">
                <button class="btn btn-primary btn-lg px-4">Generate</button>
            </div>
        </form>

        <script>
            // Weight dropdown behavior
            const weightChoice = document.getElementById("weight_choice");
            const weightOther  = document.getElementById("weight_other");

            function syncWeightOther() {
                if (weightChoice.value === "Other") {
                    weightOther.style.display = "block";
                    weightOther.required = true;
                } else {
                    weightOther.style.display = "none";
                    weightOther.required = false;
                    weightOther.value = "";
                }
            }
            weightChoice.addEventListener("change", syncWeightOther);
            syncWeightOther();

            // Cargo value -> enable/disable insurance + realtime calc
            const cargoValue = document.getElementById("cargo_value");
            const insuranceRate = document.getElementById("insurance_rate");
            const insuranceHelp = document.getElementById("insurance_help");
            const insuranceCalc = document.getElementById("insurance_calc");

            function parseNumber(val) {
                if (!val) return null;
                const n = Number(val);
                return Number.isFinite(n) ? n : null;
            }
            function parsePercent(val) {
                if (!val) return null;
                const s = String(val).trim().toLowerCase();
                if (s === "none") return null;
                const cleaned = s.replace("%", "").trim();
                const n = Number(cleaned);
                return Number.isFinite(n) ? n : null;
            }
            function fmtMoney(n) {
                return "$" + n.toFixed(2);
            }

            function syncInsuranceLockAndCalc() {
                const cv = parseNumber(cargoValue.value);

                if (cv === null || cv <= 0) {
                    insuranceRate.disabled = true;
                    insuranceRate.value = "";
                    insuranceHelp.style.display = "block";
                    insuranceCalc.textContent = "";
                    return;
                }

                insuranceRate.disabled = false;
                insuranceHelp.style.display = "none";

                const pct = parsePercent(insuranceRate.value);
                if (pct === null) {
                    insuranceCalc.textContent = "";
                    return;
                }

                const amount = (pct / 100.0) * cv;
                insuranceCalc.innerHTML = `<strong>Calculated Insurance Amount:</strong> ${fmtMoney(amount)}`;
            }

            cargoValue.addEventListener("input", syncInsuranceLockAndCalc);
            insuranceRate.addEventListener("input", syncInsuranceLockAndCalc);
            syncInsuranceLockAndCalc();

            // Reloading logic
            const reloadYes = document.getElementById("reload_yes");
            const reloadNo = document.getElementById("reload_no");
            const reloadingCount = document.getElementById("reloading_count");
            const reloadingHelp = document.getElementById("reloading_help");
            const placesWrap = document.getElementById("reloading_places_wrap");
            const placesContainer = document.getElementById("reloading_places_container");

            function clearPlaces() {
                placesContainer.innerHTML = "";
                placesWrap.style.display = "none";
            }

            function buildPlacesInputs(count) {
                clearPlaces();
                if (!count || count < 1) return;

                placesWrap.style.display = "block";
                for (let i = 1; i <= count; i++) {
                    const col = document.createElement("div");
                    col.className = "col-md-6";
                    col.innerHTML = `
                        <label class="form-label">Enter the Place/Port/Border name where reloading will be done (${i})</label>
                        <input name="reloading_place_${i}" class="form-control" placeholder="Type place/port/border name" required>
                    `;
                    placesContainer.appendChild(col);
                }
            }

            function syncReloadingUI() {
                const yesSelected = reloadYes.checked;
                if (!yesSelected) {
                    reloadingCount.disabled = true;
                    reloadingCount.value = "";
                    reloadingHelp.style.display = "block";
                    clearPlaces();
                    return;
                }

                reloadingCount.disabled = false;
                reloadingHelp.style.display = "none";

                let c = parseInt(reloadingCount.value || "0", 10);
                if (!Number.isFinite(c)) c = 0;
                if (c < 1) { clearPlaces(); return; }
                if (c > 5) { c = 5; reloadingCount.value = "5"; }

                buildPlacesInputs(c);
            }

            reloadYes.addEventListener("change", syncReloadingUI);
            reloadNo.addEventListener("change", syncReloadingUI);
            reloadingCount.addEventListener("input", syncReloadingUI);
            syncReloadingUI();
        </script>

        {% if submitted and data %}
        <hr class="my-4">

        <h5 class="fw-bold text-success">Query Submitted</h5>
        <ul class="mt-3">
            <li><strong>Quote ID:</strong> {{ data.quote_id }}</li>
            <li><strong>Company:</strong> {{ data.company_name }}</li>
            <li><strong>Salesperson Name:</strong> {{ data.salesperson_name }}</li>
            <li><strong>Origin (POL):</strong> {{ data.shipping_from }}</li>
            <li><strong>Destination (POD):</strong> {{ data.destination }}</li>

            <li><strong>Transit Border 1:</strong> {{ data.transit_border_1 }}</li>
            <li><strong>Transit Border 2:</strong> {{ data.transit_border_2 }}</li>
            <li><strong>Transit Border 3:</strong> {{ data.transit_border_3 }}</li>
            <li><strong>Transit Border 4:</strong> {{ data.transit_border_4 }}</li>

            <li><strong>Cargo Type:</strong> {{ data.cargo_type }}</li>
            <li><strong>Packaging Type:</strong> {{ data.packaging_type }}</li>

            <li><strong>Free Days to Return Container:</strong> {{ data.free_days_return }}</li>

            <!-- ✅ NEW shown -->
            <li><strong>Lifting / Labor required?:</strong> {{ data.lifting_labor_required }}</li>

            <li><strong>Reloading Required:</strong> {{ data.reloading_required }}</li>
            <li><strong>Reloading Count:</strong> {{ data.reloading_count }}</li>
            <li><strong>Reloading Places:</strong> {{ data.reloading_places }}</li>

            <li><strong>Commodity:</strong> {{ data.commodity }}</li>
            <li><strong>Weight:</strong> {{ data.weight_tons }}</li>
            <li><strong>Type of Container:</strong> {{ data.container_type }}</li>
            <li><strong>Container Size:</strong> {{ data.container_size }}</li>
            <li><strong>Number of Containers:</strong> {{ data.num_containers }}</li>

            <li><strong>Cargo Value:</strong> {{ data.cargo_value }}</li>
            <li><strong>Insurance Rate:</strong> {{ data.insurance_rate }}</li>
            <li><strong>Insurance Amount:</strong> {{ data.insurance_amount }}</li>

            <li><strong>Shipment Type:</strong> {{ data.shipment_type }}</li>
            <li><strong>Incoterm:</strong> {{ data.incoterm }}</li>
            <li><strong>Container Ownership:</strong> {{ data.container_ownership }}</li>
            <li><strong>Timestamp:</strong> {{ data.timestamp }}</li>
        </ul>

        <p class="text-muted"><em>Saved to queries.xlsx</em></p>
        {% endif %}

        {% if submitted %}
        <hr class="my-4">

        <h5 class="fw-bold text-primary">Available Routes We Provide</h5>

        {% if routes and routes|length > 0 %}
            <div class="row row-cols-1 g-3 mt-2">
                {% for r in routes %}
                <div class="col">
                    <div class="p-3 route-card {% if r.id == best_route_id %}best{% endif %}">
                        <div class="route-header">
                            <div>{{ r.title }}</div>
                            {% if r.id == best_route_id %}
                                <span class="badge-best-route">Best Route</span>
                            {% endif %}
                        </div>
                        <div class="mt-2">{{ r.path }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-warning mt-3">
                No routes found for now.
            </div>
        {% endif %}

        <hr class="my-4">
        <h5 class="fw-bold text-primary">Matching Quotes</h5>

        {% if error_msg %}
            <div class="alert alert-warning mt-3">{{ error_msg }}</div>
        {% endif %}

        {% if best_text %}
            <div class="alert alert-success mt-3 mb-2">
                <strong>{{ best_text }}</strong>
            </div>
        {% endif %}

        {% if rates and rates|length > 0 %}
            <div class="row row-cols-1 row-cols-md-2 g-3 mt-2">
                {% for r in rates %}
                <div class="col">
                    <div class="p-3 rate-card h-100 {% if r.is_best %}best{% endif %}">

                        <div class="rate-header mb-2">
                            <div>{{ r.title }}</div>
                            <div class="d-flex gap-2 align-items-center">
                                {% if r.validity_kind == "valid" %}
                                    <span class="badge-valid">{{ r.validity_label }}</span>
                                {% elif r.validity_kind == "expired" %}
                                    <span class="badge-expired">{{ r.validity_label }}</span>
                                {% else %}
                                    <span class="badge-unknown">{{ r.validity_label }}</span>
                                {% endif %}

                                {% if r.is_best %}
                                    <span class="badge-best">Best Option</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="kv">
                            {% for f in r.fields %}
                            <div class="rowline {% if f.is_grand_total %}gt-row{% endif %}">
                                <div class="key">{{ f.key }}</div>
                                <div class="val">
                                    {% if f.is_na and not f.is_grand_total %}
                                        <span class="na">N/A</span>
                                    {% else %}
                                        {{ f.val }}
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>

                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-muted mt-2">
                No quotes found matching POL + POD + Commodity in <code>prices_updated.xlsx</code>.
            </p>
        {% endif %}
        {% endif %}

    </div>
</div>
</body>
</html>
